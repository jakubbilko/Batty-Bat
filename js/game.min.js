/*

Copyright (c) 2014 Jakub Bilko (http://jakubbilko.pl)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
(function(){var e={};var t=new Phaser.Game(640,960,Phaser.CANVAS,"game");e.Init=function(e){this.menu=null};e.Credits=function(e){this.creds=null;this.cgroup=null};e.Intro=function(e){this.preloader=null;this.pgroup=null;this.copyl=null;this.stars=null;this.gf=null};e.Preload=function(e){this.pgroup2=null;this.cem=null;this.prel=null};e.Gameplay=function(e){this.score=0;this.bestScore=0;this.wallrate=1500;this.nextwall=0;this.walls=null;this.pos=480;this.killed=false;this.hero=null;this.graves1=null;this.graves2=null;this.graves3=null;this.graves4=null;this.graves5=null;this.graves6=null;this.graves7=null;this.graves8=null;this.points=null;this.fence=null;this.cemetary=null;this.moon=null;this.clouds=null;this.lastobj=null;this.socoreText;this.lastHit=" ";this.summary=null;this.jump=null;this.point=null;this.hit=null;this.graveRects=["",[106,0,106,26,77,26,82,36,106,38,106,66,90,65,90,81,106,80,106,107,80,105,47,673,16,628,0,735,198,735,182,649,159,648,142,108,118,107,118,81,138,80,134,70,110,67,120,39,151,42,151,26,122,28,124,0],[15,20,17,433,99,433,99,19,91,19,78,7,63,0],[53,0,53,40,18,75,0,77,7,92,18,91,53,126,53,584,74,584,83,127,116,99,138,102,138,74,119,74,86,40,86,0],[68,0,36,11,20,37,15,502,0,502,0,554,125,554,125,502,112,502,114,39,104,17],[0,0,16,108,46,103,81,629,106,629,105,565,91,655,91,671,107,668,106,697,81,700,77,709,106,709,107,735,124,735,122,709,152,708,151,692,121,696,121,667,135,663,137,665,119,655,118,628,143,627,160,88,182,86,198,0],[17,0,15,413,39,423,63,433,82,422,94,412,100,414,102,309,99,0],[53,0,53,459,19,492,7,493,0,509,18,508,53,546,53,584,87,584,86,544,120,509,138,509,138,483,117,484,83,457,73,0],[0,0,0,53,15,53,20,518,36,543,67,554,102,540,115,510,111,54,125,52,125,0]]};e.Credits.prototype={preload:function(){t.load.image("creds","images/credits_text.png")},create:function(){this.cgroup=this.add.group();var e=this.add.sprite(0,0,"bg");var t=this.add.sprite(30,650,"menumoon");var n=this.add.sprite(0,350,"clouds");this.creds=this.add.tileSprite(0,0,640,2210,"creds");var r=this.add.sprite(0,770,"cemetary2");this.cgroup.add(e);this.cgroup.add(t);this.cgroup.add(n);this.cgroup.add(this.creds);this.cgroup.add(r);this.cgroup.alpha=0;this.add.tween(this.cgroup._container).to({alpha:1},500,Phaser.Easing.Quartic.Out,true,0);this.input.onDown.add(this.back,this)},back:function(){var e=this.add.tween(this.cgroup._container).to({alpha:0},500,Phaser.Easing.Quartic.Out,true,0);e.onComplete.add(this.ret)},ret:function(){t.state.start("Init")},update:function(){this.creds.tilePosition.y-=2}};e.Intro.prototype={preload:function(){t.load.image("logo","images/menu/logo.png");t.load.image("clouds","images/bg_clouds.png");t.load.image("bg","images/bg_main.png");t.load.image("ttf","images/ttf.png");t.load.image("gflogo","images/gf_logo.png");t.load.image("preloader","images/preloader.png");t.load.image("copyl","images/copyloading.png");t.load.image("stars","images/bg_stars.png");t.load.spritesheet("bat","images/bat_sprite.png",77,77);t.load.image("cemetary","images/bg_cementary.png");t.load.image("cemetary2","images/cemetary2.png");t.load.image("summary","images/summgrave.png");t.load.bitmapFont("white","fonts/white.png","fonts/white.xml");t.load.bitmapFont("gradient","fonts/gradient.png","fonts/gradient.xml");t.load.audio("jump",["sounds/jump.mp3","sounds/jump.ogg"]);t.load.audio("point",["sounds/point.mp3","sounds/point.ogg"]);t.load.audio("hit",["sounds/hit.mp3","sounds/hit.ogg"]);this.game.input.maxPointers=1;this.game.stage.disableVisibilityChange=true;this.game.stage.scaleMode=Phaser.StageScaleMode.SHOW_ALL;if(this.game.device.desktop){this.game.stage.scaleMode=Phaser.StageScaleMode.SHOW_ALL;this.game.stage.scale.minWidth=320;this.game.stage.scale.minHeight=480;this.game.stage.scale.maxWidth=640;this.game.stage.scale.maxHeight=960;this.game.stage.scale.pageAlignHorizontally=true;this.game.stage.scale.pageAlignVertically=true;this.game.stage.scale.setScreenSize(true)}else{this.game.stage.scaleMode=Phaser.StageScaleMode.SHOW_ALL;this.game.stage.scale.minWidth=320;this.game.stage.scale.minHeight=480;this.game.stage.scale.maxWidth=640;this.game.stage.scale.maxHeight=960;this.game.stage.scale.pageAlignHorizontally=true;this.game.stage.scale.pageAlignVertically=true;this.game.stage.scale.forceOrientation(false,true);this.game.stage.scale.setScreenSize(true)}this.stage.backgroundColor="#000"},create:function(){this.pgroup=this.add.group();this.stars=this.add.tileSprite(0,0,640,2242,"stars");this.copyl=this.add.sprite(0,886,"copyl");this.preloader=this.add.sprite(604,924,"preloader");this.preloader.anchor.x=.5;this.preloader.anchor.y=.5;this.gf=this.add.sprite(this.world.centerX,this.world.centerY+100,"gflogo");this.gf.anchor.x=.5;this.gf.anchor.y=.5;this.pgroup.add(this.stars);this.pgroup.add(this.copyl);this.pgroup.add(this.preloader);this.pgroup.add(this.gf);this.gf.alpha=0;this.add.tween(this.gf).to({y:this.world.centerY,alpha:1},1e3,Phaser.Easing.Quartic.Out,true,500).to({y:this.world.centerY-100,alpha:0},1e3,Phaser.Easing.Quartic.Out,true,3e3);var e=this.add.tween(this.pgroup._container).to({alpha:0},500,Phaser.Easing.Quartic.Out,true,5e3,false);e.onComplete.add(this.animComplete)},animComplete:function(){t.state.start("Init")},update:function(){this.preloader.rotation+=.1;this.stars.tilePosition.y+=5}};e.Preload.prototype={preload:function(){t.load.image("wall","images/wall.png");t.load.image("grave1","images/obj_grave01.png");t.load.image("grave2","images/obj_grave02.png");t.load.image("grave3","images/obj_grave03.png");t.load.image("grave4","images/obj_grave04.png");t.load.image("grave5","images/obj_grave05.png");t.load.image("grave6","images/obj_grave06.png");t.load.image("grave7","images/obj_grave07.png");t.load.image("grave8","images/obj_grave08.png");t.load.image("ground","images/bg_ground.png");t.load.image("fence","images/bg_hedge.png");t.load.image("moon","images/bg_moon.png");t.load.image("points","images/points.png");t.load.image("restart","images/restartbtn.png");t.load.image("sumfb","images/sumfb.png")},create:function(){this.pgroup2=this.add.group();var e=this.add.sprite(0,0,"bg");var t=this.add.sprite(0,350,"clouds");t.body.velocity.x=-10;var n=this.add.sprite(30,650,"menumoon");var r=this.add.sprite(this.world.centerX,this.world.centerY-100,"bat");this.pgroup2.add(e);this.pgroup2.add(n);this.pgroup2.add(r);this.pgroup2.add(t);r.anchor.x=.5;r.animations.add("fly",[0,1,2,3,4,5,6,7],10,true);r.animations.play("fly");this.cem=this.add.tileSprite(0,770,640,198,"cemetary2");var i=this.add.sprite(0,886,"copyl");this.prel=this.add.sprite(604,924,"preloader");this.prel.anchor.x=.5;this.prel.anchor.y=.5;var s=this.add.sprite(this.world.centerX,r.position.x+150,"ttf");s.anchor.x=.5;this.pgroup2.add(this.cem);this.pgroup2.add(i);this.pgroup2.add(this.prel);this.pgroup2.add(s);this.pgroup2.alpha=.1;var o=this.add.tween(s);o.to({y:r.position.x+160},500,Phaser.Easing.Quartic.In,false,250,false);o.to({y:r.position.x+150},500,Phaser.Easing.Quartic.Out,false,0,false);o.loop();o.start();this.add.tween(this.pgroup2._container).to({alpha:1},500,Phaser.Easing.Quartic.Out,true,0,false).to({alpha:0},500,Phaser.Easing.Quartic.Out,true,5e3,false)},startGame:function(){t.state.start("Gameplay")},update:function(){this.cem.tilePosition.x-=2;this.prel.rotation+=.1;if(this.pgroup2.alpha==0){t.state.start("Gameplay")}}};e.Init.prototype={preload:function(){t.load.image("copy","images/menu/copyright.png");t.load.image("batbranch","images/menu/menubat.png");t.load.image("menubg","images/menu/menubg.png");t.load.image("menucem","images/menu/menucem.png");t.load.image("menumoon","images/menu/menumoon.png");t.load.image("play","images/menu/playbtn.png");t.load.image("mainfb","images/menu/mainfb.png");t.load.image("maini","images/menu/maini.png")},create:function(){this.menu=this.add.group();var e=this.add.sprite(0,200,"menubg");e.alpha=0;var t=this.add.sprite(0,0,"logo");var n=this.add.sprite(30,850,"menumoon");n.alpha=0;var r=this.add.sprite(0,928,"menucem");r.alpha=0;var i=this.add.sprite(-120,684,"batbranch");i.alpha=0;var s=this.add.sprite(5,915,"copy");s.alpha=0;var o=this.add.button(this.world.centerX,430,"play",this.startGame,this);var u=this.add.button(408,592,"mainfb",this.onFb,this);var a=this.add.button(307,592,"maini",this.onInfo,this);this.menu.add(e);this.menu.add(t);this.menu.add(n);this.menu.add(r);this.menu.add(i);this.menu.add(o);this.menu.add(u);this.menu.add(a);this.menu.add(s);o.anchor.x=.5;o.anchor.y=.5;o.scale.x=0;o.scale.y=0;u.anchor.x=.5;u.anchor.y=.5;u.scale.x=0;u.scale.y=0;a.anchor.x=.5;a.anchor.y=.5;a.scale.x=0;a.scale.y=0;this.add.tween(e).to({alpha:1,y:0},1e3,Phaser.Easing.Quartic.Out,true,0,false);this.add.tween(n).to({alpha:1,y:650},1e3,Phaser.Easing.Quartic.Out,true,0,false);this.add.tween(r).to({alpha:1,y:828},1e3,Phaser.Easing.Quartic.Out,true,0,false);this.add.tween(s).to({alpha:1},10,Phaser.Easing.Quartic.Out,true,400,false);this.add.tween(i).to({alpha:1,y:584},1e3,Phaser.Easing.Quartic.Out,true,1200,false);this.add.tween(o.scale).to({x:1,y:1},500,Phaser.Easing.Bounce.Out,true,1200,false);this.add.tween(a.scale).to({x:1,y:1},500,Phaser.Easing.Bounce.Out,true,1300,false);this.add.tween(u.scale).to({x:1,y:1},500,Phaser.Easing.Bounce.Out,true,1400,false)},onInfo:function(){var e=this.add.tween(this.menu._container).to({alpha:0},500,Phaser.Easing.Quartic.Out,true,0,false);e.onComplete.add(this.creds,this)},creds:function(){t.state.start("Credits")},onFb:function(){document.getElementById("fb").click()},startGame:function(){var e=this.add.tween(this.menu._container).to({alpha:0},500,Phaser.Easing.Quartic.Out,true,0,false);e.onComplete.add(this.start,this)},start:function(){t.state.start("Preload")}};e.Gameplay.prototype={preload:function(){},create:function(){this.killed=false;this.score=0;this.jump=this.add.sound("jump");this.point=this.add.sound("point");this.hit=this.add.sound("hit");this.add.sprite(0,0,"bg");this.add.sprite(0,810,"ground");this.cemetary=this.add.tileSprite(0,620,640,198,"cemetary");this.moon=this.add.sprite(300,50,"moon");this.clouds=this.add.sprite(250,50,"clouds");this.fence=this.add.tileSprite(0,710,640,99,"fence");this.walls=t.add.group();var e=this.walls.create(0,-50,"wall");e.body.immovable=true;e=this.walls.create(0,1030,"wall");e.body.immovable=true;this.graves1=t.add.group();this.graves2=t.add.group();this.graves3=t.add.group();this.graves4=t.add.group();this.graves5=t.add.group();this.graves6=t.add.group();this.graves7=t.add.group();this.graves8=t.add.group();this.points=t.add.group();this.graves1.createMultiple(3,"grave1");this.graves2.createMultiple(3,"grave2");this.graves3.createMultiple(3,"grave3");this.graves4.createMultiple(3,"grave4");this.graves5.createMultiple(3,"grave5");this.graves6.createMultiple(3,"grave6");this.graves7.createMultiple(3,"grave7");this.graves8.createMultiple(3,"grave8");this.points.createMultiple(3,"points");this.graves1.setAll("anchor.y",.5);this.graves2.setAll("anchor.y",.5);this.graves3.setAll("anchor.y",.5);this.graves4.setAll("anchor.y",.5);this.graves5.setAll("anchor.y",.5);this.graves6.setAll("anchor.y",.5);this.graves7.setAll("anchor.y",.5);this.graves8.setAll("anchor.y",.5);this.graves1.setAll("anchor.x",.5);this.graves2.setAll("anchor.x",.5);this.graves3.setAll("anchor.x",.5);this.graves4.setAll("anchor.x",.5);this.graves5.setAll("anchor.x",.5);this.graves6.setAll("anchor.x",.5);this.graves7.setAll("anchor.x",.5);this.graves8.setAll("anchor.x",.5);this.points.setAll("anchor.x",.5);this.points.setAll("anchor.y",.5);this.graves1.setAll("outOfBoundsKill",true);this.graves2.setAll("outOfBoundsKill",true);this.graves3.setAll("outOfBoundsKill",true);this.graves4.setAll("outOfBoundsKill",true);this.graves5.setAll("outOfBoundsKill",true);this.graves6.setAll("outOfBoundsKill",true);this.graves7.setAll("outOfBoundsKill",true);this.graves8.setAll("outOfBoundsKill",true);this.points.setAll("outOfBoundsKill",true);this.hero=t.add.sprite(200,480,"bat");this.hero.reset(200,480);this.hero.pivot.x=40;this.hero.pivot.y=28;this.hero.body.gravity.y=1100;this.hero.body.setRectangle(47,40,15,29);this.hero.animations.add("fly",[0,1,2,3,4,5,6,7],10,true);this.hero.animations.play("fly");this.input.onDown.add(this.fly,this);this.socoreText=this.add.bitmapText(this.world.centerX,50,this.score.toString(),{font:"52px White",align:"center"})},render:function(){},fly:function(){if(!this.killed){this.jump.play();this.hero.body.velocity.y=-300}},update:function(){if(!this.killed){this.fence.tilePosition.x-=3;this.cemetary.tilePosition.x-=2;this.clouds.x-=.5}this.physics.collide(this.hero,this.walls);this.physics.overlap(this.hero,this.graves1,this.obstCollision,null,this);this.physics.overlap(this.hero,this.graves2,this.obstCollision,null,this);this.physics.overlap(this.hero,this.graves3,this.obstCollision,null,this);this.physics.overlap(this.hero,this.graves4,this.obstCollision,null,this);this.physics.overlap(this.hero,this.graves5,this.obstCollision,null,this);this.physics.overlap(this.hero,this.graves6,this.obstCollision,null,this);this.physics.overlap(this.hero,this.graves7,this.obstCollision,null,this);this.physics.overlap(this.hero,this.graves8,this.obstCollision,null,this);this.physics.overlap(this.hero,this.points,this.pointsCollision,null,this);this.hero.body.velocity.x=0;if(this.time.now>this.nextwall&&!this.killed){this.pos=this.getRandomInt(200);this.nextwall=this.time.now+this.wallrate;var e=this.getRandomGrave(4);var t=this.getRandomGrave(4);if(e==t){if(e==1)t=4;else if(e==4)t=1;else t++}t+=4;var n;var r;var i;r=this["graves"+e].getFirstDead();n=this["graves"+t].getFirstDead();i=this.points.getFirstDead();r.body.setPolygon(this.graveRects[e]);n.body.setPolygon(this.graveRects[t]);n.reset(660,this.pos+50);r.reset(660,n.y+n.height/2+r.height/2+115);i.reset(660,this.world.centerY);i.name="point"+Math.random().toString();n.body.velocity.x=-200;r.body.velocity.x=-200;i.body.velocity.x=-200}this.socoreText.setText(this.score.toString())},getRandomInt:function(e){var t=Math.floor(Math.random()*e)+1;return t},getRandomGrave:function(e){var t=Math.floor(Math.random()*e)+1;return t},pointsCollision:function(e,t){if(this.lastHit!=t.name&&t.x<this.hero.x){this.score++;this.lastHit=t.name;this.point.play()}},obstCollision:function(e,n){if(!this.killed){this.hit.play();if(this.score>this.bestScore)this.bestScore=this.score;this.graves1.setAll("body.velocity.x",0);this.graves2.setAll("body.velocity.x",0);this.graves3.setAll("body.velocity.x",0);this.graves4.setAll("body.velocity.x",0);this.graves5.setAll("body.velocity.x",0);this.graves6.setAll("body.velocity.x",0);this.graves7.setAll("body.velocity.x",0);this.graves8.setAll("body.velocity.x",0);this.points.setAll("body.velocity.x",0);this.summary=t.add.group();var r=this.summary.create(0,0,"summary");var i=this.add.button(384,646,"restart",this.onResetClick,this);var s=this.add.bitmapText(this.world.centerX,440,this.score.toString(),{font:"150px Gradient",align:"center"});var o=this.add.bitmapText(440,850,this.bestScore.toString(),{font:"52px White",align:"center"});var u=this.add.button(278,693,"sumfb",this.onFbClick,this);o.anchor.x=.5;s.anchor.x=.5;this.summary.y=960;this.summary.add(s);this.summary.add(o);this.summary.add(i);this.summary.add(u);this.add.tween(this.summary._container.position).to({y:0},1e3,Phaser.Easing.Quartic.Out,true,0,false);this.hero.rotation=1;this.hero.animations.stop();this.killed=true}},onFbClick:function(){document.getElementById("fb").click()},onResetClick:function(){t.state.start("Gameplay",true,true)}};t.state.add("Init",e.Init);t.state.add("Gameplay",e.Gameplay);t.state.add("Preload",e.Preload);t.state.add("Intro",e.Intro);t.state.add("Credits",e.Credits);t.state.start("Intro")})()